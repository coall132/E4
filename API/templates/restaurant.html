{% extends "base.html" %}
{% set ACTIVE = "restaurants" %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Données restaurants</h2>
  <form id="search-form" class="row g-2">
    <div class="col-sm-6"><input class="form-control" name="q" placeholder="Nom contient…"></div>
    <div class="col-sm-4"><input class="form-control" name="city" placeholder="Code postal…"></div>
    <div class="col-sm-2 d-grid"><button class="btn btn-outline-primary">Rechercher</button></div>
  </form>
  <div class="table-responsive mt-4">
    <table class="table table-dark table-striped align-middle">
      <thead><tr><th>ID</th><th>Nom</th><th>Adresse</th><th>CP</th><th>Rating</th></tr></thead>
      <tbody id="data-rows"></tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
const rows = document.getElementById('data-rows');
const form = document.getElementById('search-form');

async function load(q='', city='') {
  const params = new URLSearchParams({limit:'50'});
  if (q) params.set('q', q);
  if (city) params.set('city', city);
  const r = await fetch(`/ui/api/restaurants?${params}`);
  const data = await r.json();
  rows.innerHTML = (data.items || []).map(it => `
    <tr>
      <td>${it.id ?? ''}</td>
      <td>${it.nom ?? ''}</td>
      <td>${it.adresse ?? ''}</td>
      <td>${it.code_postal ?? ''}</td>
      <td>${(it.rating ?? 0).toFixed(1)}</td>
    </tr>
  `).join('');
}
form.addEventListener('submit', e => {
  e.preventDefault();
  const fd = new FormData(form);
  load(fd.get('q')||'', fd.get('city')||'');
});
load();
</script>
{% endblock %}
